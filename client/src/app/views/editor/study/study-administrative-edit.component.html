<ng-container *ngIf="study; else loadingStudy;">

  <study-sidebar [study]="study"
                   [activeSection]="sidebarActiveSection">
  </study-sidebar>

  <div class="content-container">

    <div class="content-header container-fluid">
      <div class="row">
        <div class="col-xs-12">
          <h1>{{ study.prefLabel | lang }}</h1>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-12">
          <last-modified [modifier]="study.lastModifiedByUser"
                         [lastModifiedDate]="study.lastModifiedDate">
          </last-modified>
        </div>
      </div>
    </div>

    <div class="content-body container-fluid">

      <form #studyForm="ngForm">

        <div class="row">
          <div class="col-xs-12">
            <h2>{{ 'description' | translate }}</h2>
            <p class="preserve-line-breaks">{{ study.description | lang }}</p>
          </div>
        </div>

        <div class="row">
          <div class="col-xs-12">
            <h2>{{ 'registryOrganization' | translate }}</h2>
            <p *ngIf="study.ownerOrganization">
              {{ study.ownerOrganization.prefLabel | lang }}
              <span *ngIf="study.ownerOrganization.abbreviation | lang">
              ({{ study.ownerOrganization.abbreviation | lang }})
            </span>
            </p>
          </div>
        </div>

        <div class="row">
          <div class="col-xs-12">
            <h2>{{ 'registryOrganizationUnit' | translate }}</h2>
            <p *ngFor="let ownerOrganizationUnit of study.ownerOrganizationUnit">
              {{ ownerOrganizationUnit.prefLabel | lang }}
              <span *ngIf="ownerOrganizationUnit.abbreviation | lang">
              ({{ ownerOrganizationUnit.abbreviation | lang }})
            </span>
            </p>
          </div>
        </div>

        <div class="row" *ngIf="study.ownerOrganization && study.ownerOrganization.addressForRegistryPolicy">
          <div class="col-xs-12">
            <h2>{{ 'addressForRegistryPolicy' | translate }}</h2>
            <p class="preserve-line-breaks">
              {{ study.ownerOrganization.addressForRegistryPolicy | lang }}
            </p>
          </div>
        </div>

        <div class="row" *ngIf="study.ownerOrganization && study.ownerOrganization.phoneNumberForRegistryPolicy">
          <div class="col-xs-12">
            <h2>{{ 'phoneNumberForRegistryPolicy' | translate }}</h2>
            <p>
              {{ study.ownerOrganization.phoneNumberForRegistryPolicy }}
            </p>
          </div>
        </div>

        <div class="row">
          <div class="col-xs-12">
            <h2>{{ 'personInRoles.label' | translate }}</h2>
            <table *ngIf="study.personInRoles.length; else noStudyPersonInRoles;"
                   class="table table-striped table-hover">
              <tr>
                <th translate="personInRoles.person"></th>
                <th translate="personInRoles.role"></th>
                <th translate="personInRoles.public.title"></th>
              </tr>
              <tr *ngFor="let personInRole of study.personInRoles">
                <td>
                  {{ personInRole.person.firstName }}
                  {{ personInRole.person.lastName }}
                  <ng-container *ngIf="personInRole.person.email">
                    <br>
                    {{ personInRole.person.email }}
                  </ng-container>
                  <ng-container *ngIf="personInRole.person.phone">
                    <br>
                    {{ personInRole.person.phone }}
                  </ng-container>
                </td>
                <td>
                  <ng-container *ngIf="personInRole.role; else noRole;">
                    {{ personInRole.role.prefLabel | lang }}
                  </ng-container>
                  <ng-template #noRole>
                    {{ 'noRole' | translate }}
                  </ng-template>
                </td>
                <td>
                  {{ 'personInRoles.public.' + personInRole.public | translate }}
                </td>
              </tr>
            </table>
            <ng-template #noStudyPersonInRoles>
              <p translate="noStudyPersonInRoles"></p>
            </ng-template>
          </div>
        </div>

        <div class="form-group">
          <label for="registryPolicy" translate="registryPolicy"></label>
          <textarea [(ngModel)]="study.registryPolicy[language]"
                    thlAutogrow
                    id="registryPolicy"
                    name="registryPolicy"
                    class="form-control"
                    rows="6">
          </textarea>
        </div>

        <label for="person-registry">{{"isStudyPersonRegistry"|translate}}</label>
        <div class="form-group">
          <div id="person-registry" class="radio">
            <label>
              <input type="radio" name="person-registry" [(ngModel)]="study.personRegistry" value="true">
              {{"true"|translate}}
            </label>
          </div>
          <div class="radio">
            <label>
              <input type="radio" name="person-registry" [(ngModel)]="study.personRegistry" value="false">
              {{"false"|translate}}
            </label>
          </div>
          <div class="radio">
            <label>
              <input type="radio" name="person-registry" [(ngModel)]="study.personRegistry" value="">
              {{"noPersonRegistry"|translate}}
            </label>
          </div>
        </div>

        <div class="form-group" *ngIf="study.personRegistry && study.personRegistry === 'true'">
          <label for="purposeOfPersonRegistry" translate="purposeOfPersonRegistry"></label>
          <textarea [(ngModel)]="study.purposeOfPersonRegistry[language]"
                    thlAutogrow
                    id="purposeOfPersonRegistry"
                    name="purposeOfPersonRegistry"
                    class="form-control"
                    rows="6">
          </textarea>
        </div>

        <div class="row">
          <div class="col-xs-12">
            <ng-container *ngIf="study.population">

              <h2>{{ 'population' | translate }}</h2>
              <p>{{ study.population.prefLabel | lang }}</p>

            </ng-container>
          </div>
        </div>

        <div class="row">
          <div class="col-xs-12">
            <h2>{{ 'referencePeriod' | translate }}</h2>
            <p *ngIf="study.referencePeriodStart || study.referencePeriodEnd; else noReferencePeriod;">
              <ng-container *ngIf="study.referencePeriodStart">
                {{ study.referencePeriodStart | date:'dd.MM.yyyy' }}
              </ng-container>
              â€”
              <ng-container *ngIf="study.referencePeriodEnd">
                {{ study.referencePeriodEnd | date:'dd.MM.yyyy' }}
              </ng-container>
            </p>
            <ng-template #noReferencePeriod>
              <p>{{ 'noReferencePeriod' | translate }}</p>
            </ng-template>
          </div>
        </div>

      </form>

    </div>

    <div class="edit-controls-padding"></div>

  </div>

  <div class="edit-controls-fixed">
    <div class="container-fluid">
      <div class="row">
        <div class="col-xs-12">
          <button (click)="save()"
                  [disabled]="savingInProgress"
                  class="btn btn-primary"
                  type="button">
            <span class="glyphicon glyphicon-floppy-disk"></span>
            {{ 'save' | translate }}
          </button>
          <button (click)="goBack()"
                  [disabled]="savingInProgress"
                  class="btn btn-default"
                  type="button">
            {{ 'cancel' | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>

</ng-container>

<ng-template #loadingStudy>
  <thl-spinner></thl-spinner>
</ng-template>
