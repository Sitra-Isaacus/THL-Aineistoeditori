<ng-container *ngIf="dataset; else loadingDataset;">
  <div class="row">
    <div class="col-xs-12">
      <h1>
        {{ dataset.prefLabel | lang }}
        <span *ngIf="dataset.abbreviation | lang">
          ({{ dataset.abbreviation | lang }})
        </span>
      </h1>
      <h2 *ngIf="dataset.altLabel | lang" class="alt-label">
        {{ dataset.altLabel | lang }}
      </h2>
    </div>
  </div>

  <div class="row">

    <!-- Right main column -->
    <div class="col-sm-3 col-sm-push-9">

      <h2 *ngIf="dataset.owner">
        {{ dataset.owner.prefLabel | lang }}
        <span *ngIf="dataset.owner.abbreviation | lang">
          ({{ dataset.owner.abbreviation | lang }})
        </span>
      </h2>

      <!-- TODO: Add contact person after adding it to new API. -->

    <ng-container *ngIf="(dataset.datasetTypes && dataset.datasetTypes.length)">
      
      <p>
        <strong *ngIf="dataset.datasetTypes">
          {{ 'datasetType' | translate }}
        </strong>
      </p>
      <p *ngFor="let datasetType of dataset.datasetTypes">{{datasetType.prefLabel | lang }}</p>

    </ng-container>

      <p>
        <strong *ngIf="dataset.usageCondition || (dataset.usageConditionAdditionalInformation | lang)">
          {{ 'usageCondition' | translate }}
        </strong>
      </p>

      <p *ngIf="dataset.usageCondition">
        {{ dataset.usageCondition.prefLabel | lang }}
      </p>

      <p *ngIf="dataset.usageConditionAdditionalInformation">
        <span class="preserve-line-breaks">{{ dataset.usageConditionAdditionalInformation | lang }}</span>
      </p>

      <div *ngIf="dataset.links && dataset.links.length">
        <p><strong>{{'links'|translate}}</strong></p>
        <p *ngFor="let link of dataset.links">
            <a href="{{ link.linkUrl | lang }}" target="_blank">
                {{ link.prefLabel | lang }}
            <span class="glyphicon glyphicon-link"></span>
            </a>
        </p>
      </div>
    </div>

    <!-- Left main column -->
    <div class="col-sm-9 col-sm-pull-3">
      <div class="row">
        <div class="col-xs-12">
          <h2>{{ 'description' | translate }}</h2>
          <p class="preserve-line-breaks">{{ dataset.description | lang }}</p>
        </div>
      </div>

      <div *ngIf="dataset.registryPolicy | lang" class="row">
        <div class="col-xs-12">
          <h2>{{ 'registryPolicy' | translate }}</h2>
          <p class="preserve-line-breaks">{{ dataset.registryPolicy | lang }}</p>
        </div>
      </div>

      <div *ngIf="dataset.conceptsFromScheme.length || (dataset.freeConcepts && dataset.freeConcepts[language])"
           class="row">
        <div class="col-xs-12">
          <h2>{{ 'concepts' | translate }}</h2>
          <p style="line-height:2.2em;">
            <span *ngFor="let concept of dataset.conceptsFromScheme">
              <span pTooltip="{{ 'source' | translate }}: {{ concept.conceptScheme.prefLabel | lang }}"
                tooltipPosition="bottom"
                style="margin-right:1em;white-space:nowrap;">
                {{ concept.prefLabel | lang }}
              </span>
            </span>
            <ng-container *ngIf="dataset.freeConcepts && dataset.freeConcepts[language]">
              <span *ngFor="let concept of dataset.freeConcepts[language].split(';')">
                <span style="margin-right:1em;white-space:nowrap;">
                  {{ concept }}
                </span>
              </span>
            </ng-container>
          </p>
        </div>
      </div>

      <div class="row">

        <ng-container *ngIf="dataset.population">
          <div *ngIf="dataset.population.prefLabel | lang"
            class="col-sm-6 col-md-4">
            <div class="bordered-box">
              <h2>{{ 'population' | translate }}</h2>
              <p>{{ dataset.population.prefLabel | lang }}</p>
            </div>
          </div>

          <div *ngIf="dataset.population.geographicalCoverage | lang"
            class="col-sm-6 col-md-4">
            <div class="bordered-box">
              <h2>{{ 'geographicalCoverage' | translate }}</h2>
              <p>{{ dataset.population.geographicalCoverage | lang }}</p>
            </div>
          </div>

          <div *ngIf="dataset.population.sampleSize | lang"
            class="col-sm-6 col-md-4">
            <div class="bordered-box">
              <h2>{{ 'sampleSize' | translate }}</h2>
              <p>{{ dataset.population.sampleSize | lang }}</p>
            </div>
          </div>

          <div class="clearfix visible-md-block"></div>

          <div *ngIf="dataset.numberOfObservationUnits"
            class="col-sm-6 col-md-4">
            <div class="bordered-box">
              <h2 translate="numberOfObservationUnits"></h2>
              <p>{{ dataset.numberOfObservationUnits }}</p>
            </div>
          </div>

          <div *ngIf="dataset.population.loss | lang"
            class="col-sm-6 col-md-4">
            <div class="bordered-box">
              <h2>{{ 'loss' | translate }}</h2>
              <p>{{ dataset.population.loss | lang }}</p>
            </div>
          </div>

          <div *ngIf="dataset.referencePeriodStart || dataset.referencePeriodEnd"
            class="col-sm-6 col-md-4">
            <div class="bordered-box">
              <h2>{{ 'referencePeriod' | translate }}</h2>
              <p *ngIf="dataset.referencePeriodStart">
                {{ 'referencePeriodStart' | translate }}:
                {{ dataset.referencePeriodStart | date:'dd.MM.yyyy' }}
              </p>
              <p *ngIf="dataset.referencePeriodEnd">
                {{ 'referencePeriodEnd' | translate }}:
                {{ dataset.referencePeriodEnd | date:'dd.MM.yyyy' }}
              </p>
            </div>
          </div>

          <div class="clearfix visible-md-block"></div>

          <div *ngIf="dataset.lifecyclePhase" class="col-sm-6 col-md-4">
            <div class="bordered-box">
              <h2>{{ 'lifecyclePhase' | translate }}</h2>
              <p>{{ dataset.lifecyclePhase.prefLabel | lang }}</p>
            </div>
          </div>
        </ng-container>

      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-xs-12">
      <h2>{{ 'variables' | translate }}</h2>

      <table *ngIf="(dataset.instanceVariables && dataset.instanceVariables.length); else noInstanceVariables;"
        class="table table-striped table-hover">
        <tr>
          <th>{{ 'prefLabel' | translate }}</th>
          <th>{{ 'description' | translate }}</th>
          <th>{{ 'technicalName' | translate }}</th>
          <th>{{ 'referencePeriod' | translate }}</th>
        </tr>
        <tr *ngFor="let variable of dataset.instanceVariables"
          routerLink="/catalog/datasets/{{ dataset.id }}/instanceVariables/{{ variable.id }}">
          <td>
            <a routerLink="/catalog/datasets/{{ dataset.id }}/instanceVariables/{{ variable.id }}">{{ variable.prefLabel | lang }}</a>
          </td>
          <td>
            <span class="preserve-line-breaks">{{ variable.description | lang }}</span>
          </td>
          <td>
              {{ variable.technicalName }}
          </td>
          <td>
            <ng-container *ngIf="(variable.referencePeriodStart || variable.referencePeriodEnd); else inheritedReferencePeriod;">
              <em>
                {{ variable.referencePeriodStart }}
                —
                {{ variable.referencePeriodEnd }}
              </em>
            </ng-container>
            <ng-template #inheritedReferencePeriod>
              <ng-container *ngIf="(dataset.referencePeriodStart || dataset.referencePeriodEnd)">
                {{ dataset.referencePeriodStart }}
                —
                {{ dataset.referencePeriodEnd }}
              </ng-container>
            </ng-template>
          </td>
        </tr>
      </table>

      <ng-template #noInstanceVariables>
        <p>{{ 'noInstanceVariables' | translate }}</p>
      </ng-template>
    </div>
  </div>

</ng-container>

<ng-template #loadingDataset>
  <thl-spinner></thl-spinner>
</ng-template>

<hr>

<div class="row">
  <div class="col-xs-12">
    <button class="btn btn-default" routerLink="/catalog/datasets">
      <span class="glyphicon glyphicon-chevron-left"></span>
      {{ 'back' | translate }}
    </button>
  </div>
</div>
